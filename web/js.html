<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
<!--     <script type='text/javascript' id='lt_ws' src='http://localhost:53965/socket.io/lighttable/ws.js'></script> -->
  <body>
    <script src="datascript-0.1.3.min.js" type="text/javascript"></script>
<!--     <script src="out/goog/base.js" type="text/javascript"></script>
    <script src="datascript.js" type="text/javascript"></script>
    <script type="text/javascript">goog.require("datascript.js");</script> -->
    <script type="text/javascript">
      var d = datascript.js;
      
      var db = d.empty_db();
      var db1 = d.with_datoms(db, [[":db/add", 1, "name", "Ivan"],
                                   [":db/add", 1, "age", 17]]);
      var db2 = d.with_datoms(db1, [{":db/id": 2,
                                     "name": "Igor",
                                     "age": 35}]);
      var q = '[:find ?n ?a :where [?e "name" ?n] [?e "age" ?a]]';
      var res = d.q(q, db2);
      for (var i in res) {
        console.log(res[i]);
      }
      
      var conn = d.create_conn();
      d.listen(conn, function(report) { console.log("Added " + report.tx_data.length + " datoms");
                                        console.log(report.tx_data[0]);});
      var tx_report = d.transact(conn, [[":db/add", -1, "name", "Ivan"],
                                        [":db/add", -1, "age", 17],
                                        {":db/id": -2,
                                         "name": "Igor",
                                         "age": 35}]);
      var res2 = d.q(q, d.db(conn));
      for (var i in res2) {
        console.log(res2[i]);
      }
      console.log(tx_report.tx_data);
      console.log(tx_report.tempids);
      
      var ent = d.entity(d.db(conn), 1);
      console.log(ent);
    </script>
  </body>
</html>
